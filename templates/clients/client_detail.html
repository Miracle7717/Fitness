{% extends 'base.html' %}

{% block title %}{{ client.get_full_name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Заголовок и кнопки -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-0">
                    <i class="fas fa-user"></i> {{ client.get_full_name }}
                </h1>
                <p class="text-muted mb-0">ID: {{ client.id }}</p>
            </div>
            <div class="btn-group">
                <a href="{% url 'client_update' client.pk %}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Редактировать
                </a>
                <a href="{% url 'client_delete' client.pk %}" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Удалить
                </a>
                <a href="{% url 'client_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Назад
                </a>
            </div>
        </div>
        
        <!-- Основная информация -->
        <div class="row">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Основная информация</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Фамилия:</strong> {{ client.last_name }}</p>
                                <p><strong>Имя:</strong> {{ client.first_name }}</p>
                                {% if client.middle_name %}
                                <p><strong>Отчество:</strong> {{ client.middle_name }}</p>
                                {% endif %}
                                <p><strong>Телефон:</strong> {{ client.phone }}</p>
                                <p><strong>Email:</strong> {{ client.email|default:"Не указан" }}</p>
                            </div>
                            <div class="col-md-6">
                                {% if client.birth_date %}
                                <p><strong>Дата рождения:</strong> {{ client.birth_date|date:"d.m.Y" }}</p>
                                <p><strong>Возраст:</strong> {{ client.get_age }} лет</p>
                                {% endif %}
                                <p><strong>Статус:</strong> 
                                    {% if client.status == 'active' %}
                                    <span class="badge bg-success">Активный</span>
                                    {% elif client.status == 'inactive' %}
                                    <span class="badge bg-secondary">Неактивный</span>
                                    {% elif client.status == 'suspended' %}
                                    <span class="badge bg-warning">Приостановлен</span>
                                    {% endif %}
                                </p>
                                <p><strong>Дата регистрации:</strong> {{ client.registration_date|date:"d.m.Y H:i" }}</p>
                            </div>
                        </div>
                        
                        {% if client.medical_notes %}
                        <div class="alert alert-warning mt-3">
                            <h6><i class="fas fa-exclamation-triangle"></i> Медицинские противопоказания</h6>
                            <p class="mb-0">{{ client.medical_notes }}</p>
                        </div>
                        {% endif %}
                        
                        {% if client.notes %}
                        <div class="mt-3">
                            <h6>Заметки:</h6>
                            <p class="mb-0">{{ client.notes }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Активные абонементы -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Активные абонементы</h5>
                        <a href="#" class="btn btn-sm btn-success">
                            <i class="fas fa-plus"></i> Добавить абонемент
                        </a>
                    </div>
                    <div class="card-body">
                        {% if active_memberships %}
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Тариф</th>
                                        <th>Начало</th>
                                        <th>Окончание</th>
                                        <th>Осталось дней</th>
                                        <th>Осталось посещений</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for membership in active_memberships %}
                                    <tr>
                                        <td>{{ membership.plan.name }}</td>
                                        <td>{{ membership.start_date|date:"d.m.Y" }}</td>
                                        <td>{{ membership.end_date|date:"d.m.Y" }}</td>
                                        <td>
                                            {% if membership.days_remaining %}
                                                {% if membership.is_about_to_expire %}
                                                <span class="badge bg-warning">{{ membership.days_remaining }} дн.</span>
                                                {% else %}
                                                <span class="badge bg-success">{{ membership.days_remaining }} дн.</span>
                                                {% endif %}
                                            {% else %}
                                            <span class="badge bg-danger">Истек</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if membership.plan.is_unlimited %}
                                            <span class="badge bg-info">Безлимит</span>
                                            {% else %}
                                            {{ membership.remaining_visits|default:0 }}
                                            {% endif %}
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" title="Зарегистрировать посещение">
                                                <i class="fas fa-door-open"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-3">
                            <i class="fas fa-id-card fa-2x text-muted mb-2"></i>
                            <p class="text-muted mb-0">У клиента нет активных абонементов</p>
                            <a href="#" class="btn btn-sm btn-success mt-2">
                                <i class="fas fa-plus"></i> Оформить абонемент
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Боковая панель -->
            <div class="col-md-4">
                <!-- Фото клиента -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Фото</h5>
                    </div>
                    <div class="card-body text-center">
                        {% if client.photo %}
                        <img src="{{ client.photo.url }}" alt="{{ client.get_full_name }}" 
                             class="img-fluid rounded" style="max-height: 200px;">
                        {% else %}
                        <div class="py-5">
                            <i class="fas fa-user-circle fa-5x text-muted"></i>
                            <p class="text-muted mt-2">Фото не загружено</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Статистика -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Статистика</h5>
                    </div>
                    <div class="card-body">
                        <p><i class="fas fa-id-card text-primary"></i> 
                           <strong>Активных абонементов:</strong> {{ active_memberships.count }}</p>
                        <p><i class="fas fa-clock text-warning"></i> 
                           <strong>Истекших абонементов:</strong> {{ expired_memberships.count }}</p>
                        <p><i class="fas fa-history text-info"></i> 
                           <strong>Всего абонементов:</strong> {{ all_memberships.count }}</p>
                        <hr>
                        <p><i class="fas fa-calendar-alt text-success"></i> 
                           <strong>В системе с:</strong> {{ client.registration_date|date:"d.m.Y" }}</p>
                    </div>
                </div>
                
                <!-- Быстрые действия -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Быстрые действия</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="#" class="btn btn-success">
                                <i class="fas fa-credit-card"></i> Оформить платеж
                            </a>
                            <a href="#" class="btn btn-info">
                                <i class="fas fa-envelope"></i> Отправить напоминание
                            </a>
                            <a href="#" class="btn btn-warning">
                                <i class="fas fa-qrcode"></i> Сгенерировать QR-код
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}